<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaptas - Prospectador de Candidatos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); overflow: hidden; }
        .header { background: #2c3e50; color: white; padding: 25px; text-align: center; }
        .content { padding: 30px; }
        .search-section { background: #f8f9fa; padding: 25px; border-radius: 10px; border: 1px solid #e9ecef; margin-bottom: 30px; }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #2c3e50; padding-bottom: 10px; border-bottom: 2px solid #3498db; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 768px) { .form-grid, .form-grid-3 { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; font-size: 14px; }
        input, select { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 15px; transition: all 0.3s; background: white; }
        input:focus, select:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
        .btn { background: #3498db; color: white; border: none; padding: 14px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; width: 100%; }
        .btn:hover { background: #2980b9; }
        .btn:disabled { background: #bdc3c7; cursor: not-allowed; }
        .loading { display: none; text-align: center; color: #3498db; font-weight: 600; padding: 15px; background: #ebf5fb; border-radius: 8px; margin: 15px 0; }
        .results-section { background: #f8f9fa; padding: 25px; border-radius: 10px; border: 1px solid #e9ecef; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .results-count { background: #2ecc71; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 14px; }
        .export-btn { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.3s; }
        .export-btn:hover { background: #219a52; }
        .contacts-table { width: 100%; background: white; border-radius: 8px; overflow: hidden; border: 1px solid #e9ecef; }
        .table-header { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; background: #2c3e50; color: white; font-weight: 600; padding: 15px 20px; }
        .table-row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr; padding: 15px 20px; border-bottom: 1px solid #ecf0f1; transition: background 0.3s; }
        .table-row:hover { background: #f8f9fa; }
        .table-row:last-child { border-bottom: none; }
        .table-cell { padding: 5px 0; display: flex; align-items: center; }
        .linkedin-cell a { color: #0077b5; text-decoration: none; }
        .linkedin-cell a:hover { text-decoration: underline; }
        .empty-state { text-align: center; color: #7f8c8d; padding: 40px; }
        .empty-state-icon { font-size: 48px; margin-bottom: 20px; }
        .error { background: #e74c3c; color: white; padding: 12px; border-radius: 8px; margin: 15px 0; text-align: center; font-weight: 600; }
        .info-text { font-size: 12px; color: #7f8c8d; margin-top: 5px; font-style: italic; }
        .aesthetic-field { background: #f8f9fa; border: 2px dashed #bdc3c7; }
        .fields-section { margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #3498db; }
        .section-subtitle { font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #2c3e50; }
        .search-preview { background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #3498db; }
        .search-preview h4 { margin: 0 0 8px 0; color: #2c3e50; }
        .search-preview code { background: white; padding: 8px 12px; border-radius: 4px; font-family: monospace; display: block; }
        .filter-controls { background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #e74c3c; }
        .filter-controls label { display: inline-block; margin-right: 15px; font-weight: 600; }
        .filter-select { width: auto; display: inline-block; margin-right: 20px; min-width: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://kaptasglobal.io/wp-content/uploads/2024/01/kaptas-logobranco.png" style="width: 200px; height: 100px;" alt="Kaptas">
            <h2>Prospectador de Candidatos</h2>
            <p>Encontre candidatos ideais baseado nos crit√©rios da vaga</p>
        </div>

        <div class="content">
            <div class="search-section">
                <div class="section-title">üîç Crit√©rios de Busca</div>
                
                <form id="prospectForm">
                    <!-- CAMPOS PARA API (APENAS OS QUE FUNCIONAM) -->
                    <div class="fields-section">
                        <div class="section-subtitle">Crit√©rios de Busca (Enviados para a API)</div>
                        
                        <!-- Filtros de Palavra-chave Separados -->
                        <div class="form-grid-3">
                            <div class="form-group">
                                <label for="cargo">Cargo *:</label>
                                <select id="cargo" name="cargo" required>
                                    <option value="">Selecione um cargo</option>
                                    <option value="Desenvolvedor">Desenvolvedor</option>
                                    <option value="Engenheiro de Software">Engenheiro de Software</option>
                                    <option value="Desenvolvedor Frontend">Desenvolvedor Frontend</option>
                                    <option value="Desenvolvedor Backend">Desenvolvedor Backend</option>
                                    <option value="Desenvolvedor Full Stack">Desenvolvedor Full Stack</option>
                                    <option value="Engenheiro DevOps">Engenheiro DevOps</option>
                                    <option value="Cientista de Dados">Cientista de Dados</option>
                                    <option value="Analista de Dados">Analista de Dados</option>
                                    <option value="Engenheiro de Machine Learning">Engenheiro de Machine Learning</option>
                                    <option value="Gerente de Produto">Gerente de Produto</option>
                                    <option value="Gerente de Projetos">Gerente de Projetos</option>
                                    <option value="Scrum Master">Scrum Master</option>
                                    <option value="Designer UX">Designer UX</option>
                                    <option value="Designer UI">Designer UI</option>
                                    <option value="Gerente de Marketing">Gerente de Marketing</option>
                                    <option value="Especialista em Marketing Digital">Especialista em Marketing Digital</option>
                                    <option value="Gerente de Vendas">Gerente de Vendas</option>
                                    <option value="Executivo de Contas">Executivo de Contas</option>
                                    <option value="Gerente de Desenvolvimento de Neg√≥cios">Gerente de Desenvolvimento de Neg√≥cios</option>
                                    <option value="Gerente de Sucesso do Cliente">Gerente de Sucesso do Cliente</option>
                                    <option value="Gerente de RH">Gerente de RH</option>
                                    <option value="Recrutador">Recrutador</option>
                                    <option value="Analista Financeiro">Analista Financeiro</option>
                                    <option value="Gerente de Opera√ß√µes">Gerente de Opera√ß√µes</option>
                                    <option value="Diretor de Tecnologia">Diretor de Tecnologia</option>
                                    <option value="Diretor Executivo">Diretor Executivo</option>
                                    <option value="Diretor Financeiro">Diretor Financeiro</option>
                                    <option value="Diretor de Opera√ß√µes">Diretor de Opera√ß√µes</option>
                                    <option value="Analista">Analista</option>
                                    <option value="Consultor">Consultor</option>
                                    <option value="Arquiteto">Arquiteto</option>
                                    <option value="Engenheiro">Engenheiro</option>
                                    <option value="Especialista">Especialista</option>
                                    <option value="Coordenador">Coordenador</option>
                                    <option value="Supervisor">Supervisor</option>
                                    <option value="Diretor">Diretor</option>
                                    <option value="Vice-Presidente">Vice-Presidente</option>
                                </select>
                                <div class="info-text">Selecione o cargo desejado</div>
                            </div>
                            <div class="form-group">
                                <label for="especialidades">Especialidades:</label>
                                <input type="text" id="especialidades" name="especialidades" 
                                       placeholder="Ex: Python, React, Salesforce">
                                <div class="info-text">Habilidades e especialidades</div>
                            </div>
                            <div class="form-group">
                                <label for="setor">Setor:</label>
                                <input type="text" id="setor" name="setor" 
                                       placeholder="Ex: Tecnologia, Sa√∫de, Educa√ß√£o">
                                <div class="info-text">Setor de atua√ß√£o</div>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tamanho_empresa">Tamanho M√≠nimo da Empresa:</label>
                                <select id="tamanho_empresa" name="tamanho_empresa">
                                    <option value="">Qualquer tamanho</option>
                                    <option value="1,">1+ funcion√°rios</option>
                                    <option value="10,">10+ funcion√°rios</option>
                                    <option value="50,">50+ funcion√°rios</option>
                                    <option value="100,">100+ funcion√°rios</option>
                                    <option value="200,">200+ funcion√°rios</option>
                                    <option value="500,">500+ funcion√°rios</option>
                                    <option value="1000,">1000+ funcion√°rios</option>
                                    <option value="5000,">5000+ funcion√°rios</option>
                                </select>
                                <div class="info-text">N√∫mero m√≠nimo de funcion√°rios</div>
                            </div>

                            <div class="form-group">
                                <label for="localidade">Localidade:</label>
                                <input type="text" id="localidade" name="localidade" 
                                        placeholder="Ex: S√£o Paulo, Rio de Janeiro">
                                <div class="info-text">Digite o estado ou cidade</div>
                            </div>
                        </div>

                        <!-- Preview da busca -->
                        <div class="search-preview">
                            <h4>üîç Busca que ser√° realizada:</h4>
                            <code id="searchPreview">Selecione um cargo para ver a busca</code>
                        </div>
                    </div>

                    <button type="submit" class="btn" id="submitBtn">üöÄ Buscar Candidatos</button>
                    <div class="loading" id="loading">‚è≥ Buscando candidatos...</div>
                </form>
            </div>

            <div class="results-section">
                <div class="section-title">üìä Resultados</div>
                
                <!-- Controles de Filtro -->
                <div class="filter-controls" id="filterControls" style="display: none;">
                    <label for="filterCargo">Filtrar por cargo:</label>
                    <select id="filterCargo" class="filter-select">
                        <option value="">Todos os cargos</option>
                    </select>
                    <span id="filteredCount" style="font-weight: 600; color: #2c3e50;"></span>
                </div>
                
                <div id="resultsContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <p>Preencha os crit√©rios de busca e clique em "Buscar Candidatos" para come√ßar</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentContacts = [];
        let selectedCargo = '';

        // Mapeamento de cargos PT -> EN para busca na API
        const cargoMapping = {
            'Desenvolvedor': 'Developer',
            'Engenheiro de Software': 'Software Engineer',
            'Desenvolvedor Frontend': 'Frontend Developer',
            'Desenvolvedor Backend': 'Backend Developer', 
            'Desenvolvedor Full Stack': 'Full Stack Developer',
            'Engenheiro DevOps': 'DevOps Engineer',
            'Cientista de Dados': 'Data Scientist',
            'Analista de Dados': 'Data Analyst',
            'Engenheiro de Machine Learning': 'Machine Learning Engineer',
            'Gerente de Produto': 'Product Manager',
            'Gerente de Projetos': 'Project Manager',
            'Scrum Master': 'Scrum Master',
            'Designer UX': 'UX Designer',
            'Designer UI': 'UI Designer',
            'Gerente de Marketing': 'Marketing Manager',
            'Especialista em Marketing Digital': 'Digital Marketing Specialist',
            'Gerente de Vendas': 'Sales Manager',
            'Executivo de Contas': 'Account Executive',
            'Gerente de Desenvolvimento de Neg√≥cios': 'Business Development Manager',
            'Gerente de Sucesso do Cliente': 'Customer Success Manager',
            'Gerente de RH': 'HR Manager',
            'Recrutador': 'Recruiter',
            'Analista Financeiro': 'Financial Analyst',
            'Gerente de Opera√ß√µes': 'Operations Manager',
            'Diretor de Tecnologia': 'CTO',
            'Diretor Executivo': 'CEO',
            'Diretor Financeiro': 'CFO',
            'Diretor de Opera√ß√µes': 'COO',
            'Analista': 'Analyst',
            'Consultor': 'Consultant',
            'Arquiteto': 'Architect',
            'Engenheiro': 'Engineer',
            'Especialista': 'Specialist',
            'Coordenador': 'Coordinator',
            'Supervisor': 'Supervisor',
            'Diretor': 'Director',
            'Vice-Presidente': 'Vice President'
        };

        // Mapeamento reverso EN -> PT para exibi√ß√£o
        const reverseCargoMapping = Object.fromEntries(
            Object.entries(cargoMapping).map(([pt, en]) => [en, pt])
        );

        // Termos de busca bilingues para cada cargo
        const cargoSearchTerms = {
            'Desenvolvedor': ['desenvolvedor', 'developer', 'dev'],
            'Engenheiro de Software': ['engenheiro de software', 'software engineer', 'software developer'],
            'Desenvolvedor Frontend': ['desenvolvedor frontend', 'frontend developer', 'front end'],
            'Desenvolvedor Backend': ['desenvolvedor backend', 'backend developer', 'back end'],
            'Desenvolvedor Full Stack': ['desenvolvedor full stack', 'full stack developer', 'fullstack'],
            'Engenheiro DevOps': ['engenheiro devops', 'devops engineer'],
            'Cientista de Dados': ['cientista de dados', 'data scientist'],
            'Analista de Dados': ['analista de dados', 'data analyst'],
            'Engenheiro de Machine Learning': ['engenheiro de machine learning', 'machine learning engineer', 'ml engineer'],
            'Gerente de Produto': ['gerente de produto', 'product manager'],
            'Gerente de Projetos': ['gerente de projetos', 'project manager'],
            'Scrum Master': ['scrum master'],
            'Designer UX': ['designer ux', 'ux designer'],
            'Designer UI': ['designer ui', 'ui designer'],
            'Gerente de Marketing': ['gerente de marketing', 'marketing manager'],
            'Especialista em Marketing Digital': ['especialista em marketing digital', 'digital marketing specialist'],
            'Gerente de Vendas': ['gerente de vendas', 'sales manager'],
            'Executivo de Contas': ['executivo de contas', 'account executive'],
            'Gerente de Desenvolvimento de Neg√≥cios': ['gerente de desenvolvimento de neg√≥cios', 'business development manager'],
            'Gerente de Sucesso do Cliente': ['gerente de sucesso do cliente', 'customer success manager'],
            'Gerente de RH': ['gerente de rh', 'hr manager', 'human resources'],
            'Recrutador': ['recrutador', 'recruiter'],
            'Analista Financeiro': ['analista financeiro', 'financial analyst'],
            'Gerente de Opera√ß√µes': ['gerente de opera√ß√µes', 'operations manager'],
            'Diretor de Tecnologia': ['diretor de tecnologia', 'cto', 'chief technology officer'],
            'Diretor Executivo': ['diretor executivo', 'ceo', 'chief executive officer'],
            'Diretor Financeiro': ['diretor financeiro', 'cfo', 'chief financial officer'],
            'Diretor de Opera√ß√µes': ['diretor de opera√ß√µes', 'coo', 'chief operations officer'],
            'Analista': ['analista', 'analyst'],
            'Consultor': ['consultor', 'consultant'],
            'Arquiteto': ['arquiteto', 'architect'],
            'Engenheiro': ['engenheiro', 'engineer'],
            'Especialista': ['especialista', 'specialist'],
            'Coordenador': ['coordenador', 'coordinator'],
            'Supervisor': ['supervisor'],
            'Diretor': ['diretor', 'director'],
            'Vice-Presidente': ['vice-presidente', 'vice president']
        };

        // Atualizar preview da busca
        function updateSearchPreview() {
            const cargo = document.getElementById('cargo').value;
            const especialidades = document.getElementById('especialidades').value;
            const setor = document.getElementById('setor').value;
            const localidade = document.getElementById('localidade').value;
            const tamanho = document.getElementById('tamanho_empresa').value;
            
            let preview = '';
            
            if (cargo || especialidades || setor) {
                if (cargo) preview += `Cargo: ${cargo}`;
                if (especialidades) preview += `${preview ? ' | ' : ''}Especialidades: ${especialidades}`;
                if (setor) preview += `${preview ? ' | ' : ''}Setor: ${setor}`;
                
                // SEMPRE mostra Brazil no preview
                if (localidade) {
                    preview += ` em ${localidade}, Brazil`;
                } else {
                    preview += ` no Brazil`;
                }
                
                if (tamanho) {
                    const minSize = tamanho.replace(',', '');
                    preview += ` | Empresas com ${minSize}+ funcion√°rios`;
                }
            } else {
                preview = 'Selecione um cargo para ver a busca';
            }
            
            document.getElementById('searchPreview').textContent = preview;
        }

        // Fun√ß√£o para verificar match bilingue de cargos
        function cargoMatches(cargo, searchCargo) {
            if (!cargo || !searchCargo) return false;
            
            const cargoLower = cargo.toLowerCase().trim();
            const searchLower = searchCargo.toLowerCase().trim();
            
            // Busca direta por contains
            if (cargoLower.includes(searchLower)) return true;
            
            // Busca nos termos bilingues
            if (cargoSearchTerms[searchCargo]) {
                return cargoSearchTerms[searchCargo].some(term => 
                    cargoLower.includes(term.toLowerCase())
                );
            }
            
            return false;
        }

        // Filtrar resultados por cargo
        function filterResultsByCargo() {
            const filterCargo = document.getElementById('filterCargo').value;
            
            const filteredContacts = filterCargo ? 
                currentContacts.filter(contact => cargoMatches(contact.title, filterCargo)) : 
                currentContacts;

            displayFilteredResults(filteredContacts, filterCargo);
        }

        // Exibir resultados filtrados
        function displayFilteredResults(contacts, filterCargo = '') {
            const resultsContainer = document.getElementById('resultsContainer');
            const filteredCount = document.getElementById('filteredCount');

            if (contacts.length === 0) {
                resultsContainer.innerHTML = `<div class="error">‚ùå Nenhum candidato encontrado ${filterCargo ? `para "${filterCargo}"` : ''}</div>`;
                if (filteredCount) filteredCount.textContent = '';
                return;
            }

            resultsContainer.innerHTML = `
                <div class="results-header">
                    <div class="results-count">üìä ${contacts.length} candidatos ${filterCargo ? `com cargo "${filterCargo}"` : 'encontrados'}</div>
                    <button class="export-btn" onclick="exportToCSV()">üì• Exportar para CSV</button>
                </div>
                <div class="contacts-table">
                    <div class="table-header">
                        <div>Nome</div><div>Cargo</div><div>Empresa</div><div>Email</div><div>LinkedIn</div>
                    </div>
                    ${contacts.map(contact => `
                        <div class="table-row">
                            <div class="table-cell">${contact.name || 'N/A'}</div>
                            <div class="table-cell">${contact.title || 'N/A'}</div>
                            <div class="table-cell">${contact.company_name || 'N/A'}</div>
                            <div class="table-cell">${contact.email || 'N/A'}</div>
                            <div class="table-cell linkedin-cell">
                                ${contact.linkedin_url ? `<a href="${contact.linkedin_url}" target="_blank">LinkedIn</a>` : 'N/A'}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            if (filteredCount) {
                filteredCount.textContent = filterCargo ? 
                    `(${contacts.length} de ${currentContacts.length} candidatos)` : 
                    `(${contacts.length} candidatos totais)`;
            }
        }

        // Popular dropdown de filtro com cargos √∫nicos
        function populateCargoFilter(contacts) {
            const cargoFilter = document.getElementById('filterCargo');
            const cargos = [...new Set(contacts.map(contact => contact.title).filter(Boolean))].sort();
            
            cargoFilter.innerHTML = '<option value="">Todos os cargos</option>';
            cargos.forEach(cargo => {
                cargoFilter.innerHTML += `<option value="${cargo}">${cargo}</option>`;
            });
        }

        // Event listeners para todos os campos
        document.getElementById('cargo').addEventListener('change', updateSearchPreview);
        document.getElementById('especialidades').addEventListener('input', updateSearchPreview);
        document.getElementById('setor').addEventListener('input', updateSearchPreview);
        document.getElementById('localidade').addEventListener('input', updateSearchPreview);
        document.getElementById('tamanho_empresa').addEventListener('change', updateSearchPreview);
        document.getElementById('filterCargo').addEventListener('change', filterResultsByCargo);

        // Form submission
        document.getElementById('prospectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const resultsContainer = document.getElementById('resultsContainer');
            const filterControls = document.getElementById('filterControls');
            
            submitBtn.disabled = true;
            loading.style.display = 'block';
            resultsContainer.innerHTML = '<div style="text-align: center; padding: 20px;">Carregando...</div>';
            filterControls.style.display = 'none';
            
            try {
                selectedCargo = document.getElementById('cargo').value;
                const especialidades = document.getElementById('especialidades').value;
                const setor = document.getElementById('setor').value;
                const localidade = document.getElementById('localidade').value;
                
                // CORRE√á√ÉO: Sempre inclui Brazil, mesmo quando localidade est√° vazia
                const personLocations = [];
                if (localidade) {
                    personLocations.push(localidade + ", Brazil");
                } else {
                    personLocations.push("Brazil"); // SEMPRE tem Brazil
                }
                
                // Converte cargo PT para EN para API
                const cargoForAPI = cargoMapping[selectedCargo] || selectedCargo;
                
                const requestData = {
                    mode: "candidates",
                    person_titles: cargoForAPI ? [cargoForAPI] : [],
                    person_locations: personLocations, // Agora sempre tem Brazil
                    organization_num_employees_ranges: document.getElementById('tamanho_empresa').value ? [document.getElementById('tamanho_empresa').value] : [],
                    cargo: selectedCargo || "",
                    especialidades: especialidades || "", 
                    setor: setor || ""
                };

                console.log('Enviando para API:', requestData);
                
                const response = await fetch('https://api.muvecom.com.br/v1/sdr/person-lookup-v2', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                
                const responseData = await response.json();
                currentContacts = responseData.contacts || [];
                
                // Mostrar controles de filtro se houver resultados
                if (currentContacts.length > 0) {
                    filterControls.style.display = 'block';
                    populateCargoFilter(currentContacts);
                    
                    // Filtrar automaticamente pelo cargo selecionado na busca
                    if (selectedCargo) {
                        document.getElementById('filterCargo').value = selectedCargo;
                    }
                    filterResultsByCargo();
                } else {
                    displayResults(responseData);
                }
                
            } catch (error) {
                console.error('Erro:', error);
                resultsContainer.innerHTML = `<div class="error">‚ùå Erro na busca: ${error.message}</div>`;
            } finally {
                submitBtn.disabled = false;
                loading.style.display = 'none';
            }
        });

        function displayResults(data) {
            const resultsContainer = document.getElementById('resultsContainer');
            const contacts = data.contacts || [];
            
            if (contacts.length === 0) {
                resultsContainer.innerHTML = `<div class="error">‚ùå Nenhum candidato encontrado</div>`;
                return;
            }

            displayFilteredResults(contacts);
        }

        function exportToCSV() {
            const filterCargo = document.getElementById('filterCargo').value;
            const contactsToExport = filterCargo ? 
                currentContacts.filter(contact => cargoMatches(contact.title, filterCargo)) : 
                currentContacts;

            if (contactsToExport.length === 0) return alert('Nenhum candidato para exportar');
            
            let csv = 'Nome,Cargo,Empresa,Email,LinkedIn\n';
            contactsToExport.forEach(contact => {
                csv += `"${contact.name || 'N/A'}","${contact.title || 'N/A'}","${contact.company_name || 'N/A'}","${contact.email || 'N/A'}","${contact.linkedin_url || 'N/A'}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `candidatos_${filterCargo || 'todos'}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        updateSearchPreview();
    </script>
</body>
</html>
